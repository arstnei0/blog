---
import Layout from "./Layout.astro";
import emojiStatus from '$util/emoji'
import Global from '$component/Global.astro'
import Header from '@component/Header.astro'
import dayjs from 'dayjs'
import Head from '$component/Head.astro'
import ScrollProgressAndBackToTop from "@components/ScrollProgressAndBackToTop.svelte";

const { content } = Astro.props;

const {
    title = 'Blog post',
    description = 'This is one of my blog posts.',
    author = 'Zihan Chen',
    lang = 'en',
    keywords = ['blog', 'post', 'personal website'],
	url
} = content || {}

let originalDate = content?.date

const date = dayjs(originalDate, ).format('MMM D, YYYY')

const commentTheme = "preferred_color_scheme"
---

<!DOCTYPE html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<meta name="author" content={author}>
		<meta name="keywords" content={keywords.join(', ')}>
		<meta name="description" content={description}>

		<title>{ title ? `${title} ${emojiStatus} Zihan` : 'Zihan' }</title>
		<link rel="icon" href="/avatar.png" type="image/png">

		<script src="https://giscus.app/client.js"
			data-repo="zihan-ch/blog"
			data-repo-id="R_kgDOIE6d3Q"
			data-category="General"
			data-category-id="DIC_kwDOIE6d3c4CR5h7"
			data-mapping="pathname"
			data-strict="0"
			data-reactions-enabled="1"
			data-emit-metadata="0"
			data-input-position="top"
			data-theme={commentTheme}
			data-lang="en"
			crossorigin="anonymous"
			async>
		</script>
		<!-- data-loading="lazy" -->

		<Head></Head>
		
		<ScrollProgressAndBackToTop client:load></ScrollProgressAndBackToTop>

		<script define:vars={{ url }}>
			import webVitals from "$lib/webVitals"
		
			if (import.meta.env.MODE === 'production') {
				webVitals({
					page: url,
					analyticsId: import.meta.env.VERCEL_ANALYTICS_ID,
					debug: false,
				})
			}
		</script>
	</head>
	<body class="nod">
		<div id="site">
			<Header page={'post'}>
			</Header>
			<main id="main">
				<h1 id="blog-title">{title}</h1>
				<span style="font-size: 18px;">{date}{date ? ', by ' : 'By '}{author}</span>
				
				<slot />

				<div class="giscus"></div>
			</main>
		</div>
	</body>
</html>

<style>
	main {
		margin-left: 23%;
		margin-right: 23%;
		margin-top: 3%;
		margin-bottom: 15%;
	}

	#blog-title {
		font-size: 44px;
	}

	.giscus {
		margin-top: 20%;
	}
</style>

<Global></Global>