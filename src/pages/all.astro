---
import PostCard from "@components/PostCard.astro";
import Layout from "@layouts/Layout.astro";
import type { MDXInstance } from "astro";
import dayjs from "dayjs";

let posts: MDXInstance<Record<string, any>>[] | null = null;
let grouped: Record<string | symbol, MDXInstance<Record<string, any>>[]> = {};

try {
    posts = await Astro.glob('./post/*.mdx');
} catch(e) {
    
}

if (posts) {
    posts = posts.sort((a, b) => (dayjs(a.frontmatter.pubDate).isBefore(dayjs(b.frontmatter.pubDate)) ? 1 : -1))
    posts.forEach((post) => {
        const date = dayjs(post.frontmatter.pubDate).format('MMMM, YYYY')
        grouped[date] = grouped[date] ? [...grouped[date], post] : [post]
    })
}
---

<Layout title="All Blog Posts" page="latest">
    <div id="posts-c">
        <div id="all">
            <h1 id="apt">All posts:</h1>
            <span>There are {posts?.length} posts altogether.</span>

            {
                posts ? (
                    Reflect.ownKeys(grouped).map(key => {
                        return (
                            <div class="year">
                                <h2>{key}</h2>
                                <div class="apc">
                                    {
                                        grouped[key].map(post => {
                                            return <PostCard post={post.frontmatter} url={post.url}></PostCard>
                                        })
                                    }
                                </div>
                            </div>
                        )
                    })
                )
                : <h2>Sorry, I haven't written any blog posts yet.</h2>
            }
        </div>
    </div>
</Layout>

<style>
* {
    /* border: solid 1px black; */
}

#posts-c {
	margin-left: 10%;
	margin-right: 10%;
	margin-top: 3%;
	margin-bottom: 15%;
}

#apt {
    margin-bottom: 0%;
}

.apc {
    display: flex;
    flex-wrap: wrap;
    /* flex: 1; */
}

#see-ac {
    margin-top: 10%;
    display: flex;
    justify-content: flex-end;
}

.year {
    margin-bottom: 5%;
}
</style>